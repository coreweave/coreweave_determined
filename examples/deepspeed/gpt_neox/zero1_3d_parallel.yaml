name: gpt-neox-zero1-3d-parallel
debug: false
profiling:
    enabled: true
    begin_on_batch: 50
    end_after_batch: 100
    sync_timings: true
hyperparameters:
  search_world_size: false
  conf_dir: /gpt-neox/configs
  conf_file:
      - determined_cluster.yml
  wandb_group: null
  wandb_team: null
  user_script: null
  eval_tasks: null
environment:
  environment_variables:
      - NCCL_DEBUG=INFO
      # You may need to modify this to match your network configuration.
      - NCCL_SOCKET_IFNAME=ens,eth,ib
  force_pull_image: true
  image:
    gpu: liamdetermined/gpt-neox
  pod_spec:
    spec:
      volumes:
        - name: pvc-e229485f-a93b-4605-aac5-c616d9b2c3ce
          persistentVolumeClaim:
            claimName: gpt-neox-claim-2
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: gpu.nvidia.com/class
                    operator: In
                    values:
                      - A40
                  - key: topology.kubernetes.io/region
                    operator: In
                    values:
                      - ORD1
      containers:
        - name: determined-container
          volumeMounts:
          - mountPath: "/run/determined/workdir/shared_fs"
            name: pvc-e229485f-a93b-4605-aac5-c616d9b2c3ce
resources:
  slots_per_trial: 96
searcher:
  name: single
  metric: lm_loss
  smaller_is_better: false
  max_length:
    batches: 10000
min_validation_period:
    batches: 5000
max_restarts: 0
entrypoint:
  - python3
  - -m
  - determined.launch.deepspeed
  - --trial
  - gpt2_trial:GPT2Trial
